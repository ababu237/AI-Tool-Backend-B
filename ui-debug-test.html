<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UI Debug Test - Healthcare Assistant</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      .test-section {
        margin: 30px 0;
        padding: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        background: #fafafa;
      }
      .test-section h2 {
        color: #007bff;
        margin-bottom: 15px;
      }
      input,
      select,
      button {
        padding: 10px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        background: #007bff;
        color: white;
        cursor: pointer;
        font-weight: bold;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        white-space: pre-wrap;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .loading {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
      }
      .log {
        background: #e2e3e5;
        border: 1px solid #d6d8db;
        color: #383d41;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ü©∫ Healthcare Assistant UI Debug Test</h1>
      <p>
        This page tests the exact same API calls that the React components make
        to identify UI data display issues.
      </p>

      <!-- Text Translation Test -->
      <div class="test-section">
        <h2>üìù Text Translation Test</h2>
        <input
          type="text"
          id="textInput"
          placeholder="Enter text to translate"
          value="Hello world"
          style="width: 300px"
        />
        <br />
        <label>Target Language:</label>
        <select id="targetLang">
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="hi">Hindi</option>
          <option value="te">Telugu</option>
        </select>
        <br />
        <button onclick="testTranslation()" id="translateBtn">
          üîÑ Translate Text
        </button>
        <div id="translationResult" class="result" style="display: none"></div>
        <div id="translationLog" class="result log" style="display: none"></div>
      </div>

      <!-- Audio Transcription Test -->
      <div class="test-section">
        <h2>üé§ Audio Transcription Test</h2>
        <input type="file" id="audioFile" accept="audio/*" />
        <br />
        <label>Output Language:</label>
        <select id="outputLang">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
        </select>
        <br />
        <button onclick="testTranscription()" id="transcribeBtn">
          üéµ Transcribe Audio
        </button>
        <div
          id="transcriptionResult"
          class="result"
          style="display: none"
        ></div>
        <div
          id="transcriptionLog"
          class="result log"
          style="display: none"
        ></div>
      </div>

      <!-- Organ Analysis Test -->
      <div class="test-section">
        <h2>ü´Ä Organ Analysis Test</h2>
        <input type="file" id="imageFile" accept="image/*" />
        <br />
        <label>Organ Type:</label>
        <select id="organType">
          <option value="general">General</option>
          <option value="heart">Heart</option>
          <option value="lungs">Lungs</option>
          <option value="brain">Brain</option>
          <option value="kidney">Kidney</option>
        </select>
        <br />
        <button onclick="testOrganAnalysis()" id="analyzeBtn">
          üîç Analyze Organ
        </button>
        <div id="analysisResult" class="result" style="display: none"></div>
        <div id="analysisLog" class="result log" style="display: none"></div>
      </div>
    </div>

    <script>
      const API_BASE_URL = "http://localhost:5001/api";

      function log(message, elementId) {
        const logElement = document.getElementById(elementId);
        logElement.style.display = "block";
        logElement.textContent +=
          new Date().toLocaleTimeString() + ": " + message + "\n";
        console.log(message);
      }

      function showResult(content, elementId, isError = false) {
        const resultElement = document.getElementById(elementId);
        resultElement.style.display = "block";
        resultElement.className = "result " + (isError ? "error" : "success");
        resultElement.textContent = content;
      }

      function showLoading(elementId) {
        const resultElement = document.getElementById(elementId);
        resultElement.style.display = "block";
        resultElement.className = "result loading";
        resultElement.textContent = "‚è≥ Loading...";
      }

      async function testTranslation() {
        const textInput = document.getElementById("textInput").value;
        const targetLang = document.getElementById("targetLang").value;
        const btn = document.getElementById("translateBtn");

        if (!textInput.trim()) {
          alert("Please enter some text to translate");
          return;
        }

        btn.disabled = true;
        showLoading("translationResult");
        log("üöÄ Starting translation...", "translationLog");
        log(`Input: "${textInput}" ‚Üí ${targetLang}`, "translationLog");

        try {
          // Health check first
          log("üîç Checking backend health...", "translationLog");
          const healthResponse = await fetch("http://localhost:5001/health");
          if (healthResponse.ok) {
            log("‚úÖ Backend is healthy", "translationLog");
          } else {
            log("‚ö†Ô∏è Backend health check failed", "translationLog");
          }

          // Make translation request
          log("üì° Making translation API call...", "translationLog");
          const response = await fetch(`${API_BASE_URL}/translate`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              text: textInput,
              sourceLanguage: "en",
              targetLanguage: targetLang,
            }),
          });

          log(`üì• Response status: ${response.status}`, "translationLog");
          const data = await response.json();
          log(
            "üìÑ Response data: " + JSON.stringify(data, null, 2),
            "translationLog"
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${
                data.error?.message || "Unknown error"
              }`
            );
          }

          if (!data.success) {
            throw new Error(
              data.error?.message ||
                "Translation API returned unsuccessful response"
            );
          }

          // Extract translated text
          const translated =
            data.data?.translatedText || data.translatedText || null;
          log(
            `üéØ Extracted translated text: "${translated}"`,
            "translationLog"
          );

          if (!translated) {
            throw new Error("No translated text found in response");
          }

          showResult(
            `‚úÖ Translation successful!\n\nOriginal: ${textInput}\nTranslated: ${translated}`,
            "translationResult"
          );
          log("‚úÖ Translation completed successfully", "translationLog");
        } catch (error) {
          log("‚ùå Translation error: " + error.message, "translationLog");
          showResult(
            `‚ùå Translation failed:\n${error.message}`,
            "translationResult",
            true
          );
        } finally {
          btn.disabled = false;
        }
      }

      async function testTranscription() {
        const audioFile = document.getElementById("audioFile").files[0];
        const outputLang = document.getElementById("outputLang").value;
        const btn = document.getElementById("transcribeBtn");

        if (!audioFile) {
          alert("Please select an audio file");
          return;
        }

        btn.disabled = true;
        showLoading("transcriptionResult");
        log("üöÄ Starting transcription...", "transcriptionLog");
        log(
          `File: ${audioFile.name} (${audioFile.size} bytes)`,
          "transcriptionLog"
        );

        try {
          const formData = new FormData();
          formData.append("audio", audioFile);
          formData.append("outputLanguage", outputLang);

          log("üì° Making transcription API call...", "transcriptionLog");
          const response = await fetch(`${API_BASE_URL}/transcription`, {
            method: "POST",
            body: formData,
          });

          log(`üì• Response status: ${response.status}`, "transcriptionLog");
          const data = await response.json();
          log(
            "üìÑ Response data: " + JSON.stringify(data, null, 2),
            "transcriptionLog"
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${
                data.error?.message || "Unknown error"
              }`
            );
          }

          if (!data.success) {
            throw new Error(
              data.error?.message ||
                "Transcription API returned unsuccessful response"
            );
          }

          const text =
            data.data?.transcription || data.transcription || data.text || null;
          log(`üéØ Extracted transcription: "${text}"`, "transcriptionLog");

          if (!text) {
            throw new Error("No transcription text found in response");
          }

          showResult(
            `‚úÖ Transcription successful!\n\nResult: ${text}`,
            "transcriptionResult"
          );
          log("‚úÖ Transcription completed successfully", "transcriptionLog");
        } catch (error) {
          log("‚ùå Transcription error: " + error.message, "transcriptionLog");
          showResult(
            `‚ùå Transcription failed:\n${error.message}`,
            "transcriptionResult",
            true
          );
        } finally {
          btn.disabled = false;
        }
      }

      async function testOrganAnalysis() {
        const imageFile = document.getElementById("imageFile").files[0];
        const organType = document.getElementById("organType").value;
        const btn = document.getElementById("analyzeBtn");

        if (!imageFile) {
          alert("Please select an image file");
          return;
        }

        btn.disabled = true;
        showLoading("analysisResult");
        log("üöÄ Starting organ analysis...", "analysisLog");
        log(`File: ${imageFile.name} (${imageFile.size} bytes)`, "analysisLog");
        log(`Organ type: ${organType}`, "analysisLog");

        try {
          const formData = new FormData();
          formData.append("image", imageFile);
          formData.append("organ", organType);
          formData.append("input_language", "en");
          formData.append("output_language", "en");

          log("üì° Making organ analysis API call...", "analysisLog");
          const response = await fetch(
            `${API_BASE_URL}/organ-analyzer/analyze`,
            {
              method: "POST",
              body: formData,
            }
          );

          log(`üì• Response status: ${response.status}`, "analysisLog");
          const data = await response.json();
          log(
            "üìÑ Response data: " + JSON.stringify(data, null, 2),
            "analysisLog"
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${
                data.error?.message || "Unknown error"
              }`
            );
          }

          if (!data.success) {
            throw new Error(
              data.error?.message ||
                "Analysis API returned unsuccessful response"
            );
          }

          const resultData = data.data || data.result || data;
          log(
            `üéØ Extracted result data: ${JSON.stringify(resultData)}`,
            "analysisLog"
          );

          if (
            !resultData ||
            (!resultData.analysis &&
              !resultData.result &&
              !resultData.description)
          ) {
            throw new Error("No analysis results found in response");
          }

          showResult(
            `‚úÖ Analysis successful!\n\nResults: ${JSON.stringify(
              resultData,
              null,
              2
            )}`,
            "analysisResult"
          );
          log("‚úÖ Analysis completed successfully", "analysisLog");
        } catch (error) {
          log("‚ùå Analysis error: " + error.message, "analysisLog");
          showResult(
            `‚ùå Analysis failed:\n${error.message}`,
            "analysisResult",
            true
          );
        } finally {
          btn.disabled = false;
        }
      }

      // Auto-scroll logs to bottom
      function scrollToBottom(elementId) {
        const element = document.getElementById(elementId);
        element.scrollTop = element.scrollHeight;
      }

      // Set up auto-scroll for logs
      ["translationLog", "transcriptionLog", "analysisLog"].forEach((id) => {
        const observer = new MutationObserver(() => scrollToBottom(id));
        observer.observe(document.getElementById(id), {
          childList: true,
          subtree: true,
        });
      });

      console.log("üîß UI Debug Test page loaded successfully");
      console.log("Backend API URL:", API_BASE_URL);
    </script>
  </body>
</html>
